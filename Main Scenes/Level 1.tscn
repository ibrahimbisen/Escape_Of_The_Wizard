[gd_scene load_steps=16 format=2]

[ext_resource path="res://Assets/Fonts/alagard_font/alagard.ttf" type="DynamicFontData" id=1]
[ext_resource path="res://UI/GamePause.tscn" type="PackedScene" id=2]
[ext_resource path="res://Characters/Archer_Enemy.tscn" type="PackedScene" id=3]
[ext_resource path="res://UI/Hotbar.tscn" type="PackedScene" id=4]
[ext_resource path="res://Map/Game Map.tscn" type="PackedScene" id=5]
[ext_resource path="res://Characters/Enemy.tscn" type="PackedScene" id=6]
[ext_resource path="res://Main Scenes/Extraction/Extraction.tscn" type="PackedScene" id=7]
[ext_resource path="res://UI/HUD.tscn" type="PackedScene" id=8]
[ext_resource path="res://Characters/Player.tscn" type="PackedScene" id=9]
[ext_resource path="res://Main Scenes/Countdown.gd" type="Script" id=11]
[ext_resource path="res://UI/UI.gd" type="Script" id=12]

[sub_resource type="GDScript" id=4]
script/source = "extends Node2D

#Each time you make a new enemy instance, instantiate them by defining it as
#a variable and then connecting it to the current player instance and
#connect its signals to the main scene
onready var player: Player = $Player
onready var blue = $BlueAmmo

onready var enemy = $Enemy
onready var archer = $Archer_Enemy
onready var enemy1 = $Archer_Enemy2
onready var enemy2 = $Archer_Enemy3
onready var enemy3 = $Archer_Enemy4
onready var enemy4 = $Archer_Enemy5
onready var enemy5 = $Archer_Enemy6
onready var enemy6 = $a_e_7
onready var enemy7 = $a_e_8
onready var enemy8 = $a_e_9
onready var enemy9 = $a_e_10
onready var enemy10 = $a_e_11
onready var enemy11 = $a_e_12
onready var enemy12 = $a_e_13
onready var enemy13 = $a_e_14
onready var enemy14 = $a_e_15
onready var enemy15 = $a_e_16
onready var enemy16 = $a_e_17
onready var enemy17 = $a_e_18
onready var enemy18 = $a_e_19
onready var enemy19 = $a_e_20
onready var enemy20 = $a_e_21
onready var enemy21 = $a_e_22
onready var enemy22 = $a_e_23
onready var enemy23 = $a_e_24
onready var enemy24 = $a_e_25
onready var enemy25 = $a_e_26
onready var enemy26 = $a_e_27
onready var enemy27 = $a_e_28
onready var enemy28 = $a_e_29
onready var enemy29 = $a_e_30
onready var enemy30 = $a_e_31
onready var enemy31 = $a_e_32
onready var enemy32 = $a_e_33
onready var enemy33 = $a_e_34
onready var enemy34 = $a_e_35
onready var enemy35 = $a_e_36
onready var enemy36 = $a_e_37
onready var enemy37 = $a_e_38
onready var enemy38 = $a_e_39
onready var enemy39 = $a_e_40
onready var enemy40 = $a_e_41
onready var enemy41 = $a_e_42
onready var enemy42 = $a_e_43
onready var enemy43 = $a_e_44
onready var enemy44 = $a_e_45
onready var enemy45 = $a_e_46
onready var enemy46 = $a_e_47
onready var enemy47 = $a_e_48
onready var enemy48 = $a_e_49
onready var enemy49 = $a_e_50

var EnemyArray = Array()


func _ready():
	get_tree().call_group(\"archers\", \"init_player\")
	enemy.player = player
	archer.player = player
	enemy1.player = player
	enemy2.player = player
	enemy3.player = player
	enemy4.player = player
	enemy5.player = player
	enemy6.player = player
	enemy7.player = player
	enemy8.player = player
	enemy9.player = player
	enemy10.player = player
	enemy11.player = player
	enemy12.player = player
	enemy13.player = player
	enemy14.player = player
	enemy15.player = player
	enemy16.player = player
	enemy17.player = player
	enemy18.player = player
	enemy19.player = player
	enemy20.player = player
	enemy21.player = player
	enemy22.player = player
	enemy23.player = player
	enemy24.player = player
	enemy25.player = player
	enemy26.player = player
	enemy27.player = player
	enemy28.player = player
	enemy29.player = player
	enemy30.player = player
	enemy31.player = player
	enemy32.player = player
	enemy33.player = player
	enemy34.player = player
	enemy35.player = player
	enemy36.player = player
	enemy37.player = player
	enemy38.player = player
	enemy39.player = player
	enemy40.player = player
	enemy41.player = player
	enemy42.player = player
	enemy43.player = player
	enemy44.player = player
	enemy45.player = player
	enemy46.player = player
	enemy47.player = player
	enemy48.player = player
	enemy49.player = player
	
	player.connect(\"player_fired_bullet\", self, \"handle_bullet_spawned\")
	player.connect(\"player_fired_laser\", self, \"handle_laser_spawned\")
	
	
	archer.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy1.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy2.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy3.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy4.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy5.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy6.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy7.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy8.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy9.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy10.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy11.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy12.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy13.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy14.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy15.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy16.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy17.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy18.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy19.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy20.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy21.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy22.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy23.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy24.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy25.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy26.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy27.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy28.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy29.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy30.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy31.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy32.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy33.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy34.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy35.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy36.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy37.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy38.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy39.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy40.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy41.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy42.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy43.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy44.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy45.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy46.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy47.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy48.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")
	enemy49.connect(\"shoot\", self, \"handle_enemy_bullet_spawned\")


func handle_bullet_spawned(bullet: FireBall, a_position: Vector2, direction: Vector2):
	add_child(bullet)
	bullet.global_position = a_position
	bullet.set_direction(direction)


func handle_enemy_bullet_spawned(bullet: EnemyShot, a_position: Vector2, direction: Vector2):
	add_child(bullet)
	bullet.global_position = a_position
	bullet.set_direction(direction)


func handle_switched_weapon(weapon: int):
	pass

func handle_pick_up(ammo: int):
	if ammo == 3:
		player.ammoBlue += 5


func handle_laser_spawned(bullet: Laser, a_position: Vector2, direction: Vector2):
	add_child(bullet)
	bullet.set_is_casting(true)
	var fire_to = a_position + (direction * 100)
	#Sets the laser origin to the player's wand point
	bullet.global_position = a_position
	#Because the origin is now set to the player, we need to subtract the wand
	#coordinates from the coordinates of where the player clicked to get the 
	#relative end point of the raycast
	bullet.cast_to = fire_to-a_position
	#The origin is now the wand point, so the laser is drawn starting from origin
	bullet.get_node(\"Line2D\").add_point(Vector2(0,0))
	bullet.get_node(\"Line2D\").add_point(fire_to-a_position)



"

[sub_resource type="DynamicFont" id=1]
size = 40
font_data = ExtResource( 1 )

[sub_resource type="DynamicFont" id=2]
size = 40
font_data = ExtResource( 1 )

[sub_resource type="DynamicFont" id=3]
size = 40
font_data = ExtResource( 1 )

[node name="Main" type="Node2D"]
script = SubResource( 4 )

[node name="Scene" parent="." instance=ExtResource( 5 )]

[node name="UI" type="CanvasLayer" parent="."]
pause_mode = 2
script = ExtResource( 12 )

[node name="GamePause" parent="UI" instance=ExtResource( 2 )]
pause_mode = 2
visible = false

[node name="Hotbar" parent="UI" instance=ExtResource( 4 )]
position = Vector2( 389, -201 )

[node name="Extraction" parent="." instance=ExtResource( 7 )]
position = Vector2( 5159, 371 )
collision_layer = 2
collision_mask = 2

[node name="Player" parent="." instance=ExtResource( 9 )]
position = Vector2( 1552, 734 )

[node name="HUD" parent="." instance=ExtResource( 8 )]

[node name="Control" type="Control" parent="HUD"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -136.5
margin_top = 16.0
margin_right = 136.5
margin_bottom = 126.0
script = ExtResource( 11 )
minutes = 1

[node name="min" type="RichTextLabel" parent="HUD/Control"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -76.5
margin_right = -26.5
margin_bottom = 100.0
custom_fonts/normal_font = SubResource( 1 )
text = "00"
fit_content_height = true

[node name="sec" type="RichTextLabel" parent="HUD/Control"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -20.0
margin_right = 30.0
margin_bottom = 100.0
custom_fonts/normal_font = SubResource( 2 )
text = "00"

[node name="dsec" type="RichTextLabel" parent="HUD/Control"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = 36.5
margin_right = 86.5
margin_bottom = 100.0
custom_fonts/normal_font = SubResource( 3 )
text = "00"

[node name="Timer" type="Timer" parent="HUD/Control"]
process_mode = 0
wait_time = 0.1
autostart = true

[node name="Enemy" parent="." instance=ExtResource( 6 )]
position = Vector2( 1614, -1587 )

[node name="Archer_Enemy" parent="." instance=ExtResource( 3 )]
position = Vector2( 6622, 349 )

[node name="Archer_Enemy3" parent="." instance=ExtResource( 3 )]
position = Vector2( 4965, -1325 )

[node name="Archer_Enemy4" parent="." instance=ExtResource( 3 )]
position = Vector2( 4879, -1199 )

[node name="Archer_Enemy5" parent="." instance=ExtResource( 3 )]
position = Vector2( 5363, -1387 )

[node name="Archer_Enemy2" parent="." instance=ExtResource( 3 )]
position = Vector2( 5754, -1459 )

[node name="a_e_7" parent="." instance=ExtResource( 3 )]
position = Vector2( 4659, -1084 )

[node name="a_e_11" parent="." instance=ExtResource( 3 )]
position = Vector2( 5121, 39 )

[node name="Archer_Enemy6" parent="." instance=ExtResource( 3 )]
position = Vector2( 5133, -659 )

[node name="a_e_8" parent="." instance=ExtResource( 3 )]
position = Vector2( 4976, -398 )

[node name="a_e_9" parent="." instance=ExtResource( 3 )]
position = Vector2( 4764, -859 )

[node name="a_e_10" parent="." instance=ExtResource( 3 )]
position = Vector2( 1859, 803 )

[node name="a_e_12" parent="." instance=ExtResource( 3 )]
position = Vector2( 6013, -585 )

[node name="a_e_13" parent="." instance=ExtResource( 3 )]
position = Vector2( 5489, -795 )

[node name="a_e_14" parent="." instance=ExtResource( 3 )]
position = Vector2( 1850, 475 )

[node name="a_e_15" parent="." instance=ExtResource( 3 )]
position = Vector2( 7127, -983 )

[node name="a_e_16" parent="." instance=ExtResource( 3 )]
position = Vector2( 6470, -569 )

[node name="a_e_17" parent="." instance=ExtResource( 3 )]
position = Vector2( 7040, -692 )

[node name="a_e_18" parent="." instance=ExtResource( 3 )]
position = Vector2( 6443, -662 )

[node name="a_e_19" parent="." instance=ExtResource( 3 )]
position = Vector2( 6557, -660 )

[node name="a_e_20" parent="." instance=ExtResource( 3 )]
position = Vector2( 6545, 633 )

[node name="a_e_21" parent="." instance=ExtResource( 3 )]
position = Vector2( 6270, -945 )

[node name="a_e_22" parent="." instance=ExtResource( 3 )]
position = Vector2( 6930, -1207 )

[node name="a_e_23" parent="." instance=ExtResource( 3 )]
position = Vector2( 6747, -1384 )

[node name="a_e_24" parent="." instance=ExtResource( 3 )]
position = Vector2( 6279, -1435 )

[node name="a_e_25" parent="." instance=ExtResource( 3 )]
position = Vector2( 5985, -1245 )

[node name="a_e_26" parent="." instance=ExtResource( 3 )]
position = Vector2( 7180, 98 )

[node name="a_e_27" parent="." instance=ExtResource( 3 )]
position = Vector2( 1837, 344 )

[node name="a_e_28" parent="." instance=ExtResource( 3 )]
position = Vector2( 6899, -316 )

[node name="a_e_29" parent="." instance=ExtResource( 3 )]
position = Vector2( 1866, 612 )

[node name="a_e_30" parent="." instance=ExtResource( 3 )]
position = Vector2( 6698, -88 )

[node name="a_e_31" parent="." instance=ExtResource( 3 )]
position = Vector2( 6964, -544 )

[node name="a_e_32" parent="." instance=ExtResource( 3 )]
position = Vector2( 6517, -1053 )

[node name="a_e_33" parent="." instance=ExtResource( 3 )]
position = Vector2( 6897, 459 )

[node name="a_e_34" parent="." instance=ExtResource( 3 )]
position = Vector2( 7397, 129 )

[node name="a_e_35" parent="." instance=ExtResource( 3 )]
position = Vector2( 7302, -412 )

[node name="a_e_36" parent="." instance=ExtResource( 3 )]
position = Vector2( 8733, -108 )

[node name="a_e_37" parent="." instance=ExtResource( 3 )]
position = Vector2( 7378, 1297 )

[node name="a_e_38" parent="." instance=ExtResource( 3 )]
position = Vector2( 7775, 955 )

[node name="a_e_39" parent="." instance=ExtResource( 3 )]
position = Vector2( 8564, 1050 )

[node name="a_e_40" parent="." instance=ExtResource( 3 )]
position = Vector2( 7230, 918 )

[node name="a_e_41" parent="." instance=ExtResource( 3 )]
position = Vector2( 7451, 578 )

[node name="a_e_42" parent="." instance=ExtResource( 3 )]
position = Vector2( 7973, -76 )

[node name="a_e_43" parent="." instance=ExtResource( 3 )]
position = Vector2( 8302, 880 )

[node name="a_e_44" parent="." instance=ExtResource( 3 )]
position = Vector2( 8824, 282 )

[node name="a_e_45" parent="." instance=ExtResource( 3 )]
position = Vector2( 8409, 399 )

[node name="a_e_46" parent="." instance=ExtResource( 3 )]
position = Vector2( 8298, -312 )

[node name="a_e_47" parent="." instance=ExtResource( 3 )]
position = Vector2( 7655, -252 )

[node name="a_e_48" parent="." instance=ExtResource( 3 )]
position = Vector2( 7624, -9 )

[node name="a_e_49" parent="." instance=ExtResource( 3 )]
position = Vector2( 8009, -685 )

[node name="a_e_50" parent="." instance=ExtResource( 3 )]
position = Vector2( 7518, -1022 )

[connection signal="timeout" from="HUD/Control/Timer" to="HUD/Control" method="_on_Timer_timeout"]
